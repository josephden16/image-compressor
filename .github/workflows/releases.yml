name: "binary release"

on:
  push:
    tags:
      - "release-*"
      - "test-*"

jobs:
  windows-release:
    name: "Windows Binary Release"
    runs-on: "windows-latest"

    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: "16"
      - name: "Install Dependencies"
        run: npm install
      - name: "Build"
        run: npm run build
      - name: "Create Windows Binary"
        run: "npx pkg -t node16 -o image-compressor-win  dist/app.js"
      - name: Release
        uses: softprops/action-gh-release@v1
        with:
          files: image-compressor-*

  linux-release:
    name: "Linux Binary Release"
    runs-on: "ubuntu-latest"

    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: "16"
      - name: "Install Dependencies"
        run: npm install
      - name: "Build"
        run: npm run build
      - name: "Create Linux Binary"
        run: "npx pkg -t node16 -o image-compressor-linux  dist/app.js"
      - name: Release
        uses: softprops/action-gh-release@v1
        with:
          files: image-compressor-*
  macos-release:
    name: "Mac Binary Release"
    runs-on: "macos-latest"

    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: "16"
      - name: "Install Dependencies"
        run: npm install
      - name: "Build"
        run: npm run build
      - name: "Create Mac Binary"
        run: "npx pkg -t node16 -o image-compressor-mac  dist/app.js"
      - name: Release
        uses: softprops/action-gh-release@v1
        with:
          files: image-compressor-*
